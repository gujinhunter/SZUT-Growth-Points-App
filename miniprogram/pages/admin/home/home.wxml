<view class="admin-home">
  <view class="hero-card">
    <view class="hero-top">
      <view>
        <view class="hero-title">管理员控制台</view>
        <view class="hero-sub">欢迎回来，{{adminName || '管理员'}}。</view>
      </view>
      <view class="date-tag">{{today}}</view>
    </view>

    <view class="metrics-row">
      <view class="metric-card primary">
        <view class="metric-label">今日待审</view>
        <view class="metric-value">{{metrics.pendingTotal}}</view>
        <view class="metric-desc">待处理申请</view>
      </view>
      <view class="metric-card secondary">
        <view class="metric-label">累计项目</view>
        <view class="metric-value">{{metrics.totalProjects}}</view>
        <view class="metric-desc">正在管理的项目</view>
      </view>
      <view class="metric-card accent">
        <view class="metric-label">审核通过率</view>
        <view class="metric-value">{{metrics.approvalRate}}%</view>
        <view class="metric-desc">最近30天</view>
      </view>
    </view>
  </view>

  <view class="quick-grid">
    <view class="grid-title">待办快捷入口</view>
    <view class="grid-wrap">
      <view class="grid-item" data-url="/pages/admin/review/review" bindtap="goPage">
        <image class="grid-icon" src="/assets/admin/icon-review.png" mode="aspectFit"></image>
        <view class="grid-text">待审核申请</view>
        <view class="badge" wx:if="{{metrics.pendingTotal}}">{{metrics.pendingTotal}}</view>
      </view>
      <view class="grid-item" data-url="/pages/admin/projects/projects" bindtap="goPage">
        <image class="grid-icon" src="/assets/admin/icon-projects.png" mode="aspectFit"></image>
        <view class="grid-text">项目管理</view>
      </view>
      <view class="grid-item" data-url="/pages/admin/statistics/statistics" bindtap="goPage">
        <image class="grid-icon" src="/assets/admin/icon-stats.png" mode="aspectFit"></image>
        <view class="grid-text">数据统计</view>
      </view>
      <view class="grid-item" data-url="/pages/admin/reviewHistory/reviewHistory" bindtap="goPage">
        <image class="grid-icon" src="/assets/admin/icon-history.png" mode="aspectFit"></image>
        <view class="grid-text">审核历史</view>
      </view>
      <view class="grid-item" data-url="/pages/admin/users/users" bindtap="goPage">
        <image class="grid-icon" src="/assets/admin/icon-users.png" mode="aspectFit"></image>
        <view class="grid-text">账户管理</view>
      </view>
      <view class="grid-item" data-url="/pages/admin/rewards/rewards" bindtap="goPage">
        <image class="grid-icon" src="/assets/admin/icon-rewards.png" mode="aspectFit"></image>
        <view class="grid-text">奖品兑换</view>
      </view>
      <view class="grid-item" data-url="/pages/admin/redeemRecords/redeemRecords" bindtap="goPage">
        <image class="grid-icon" src="/assets/admin/icon-redeem.png" mode="aspectFit"></image>
        <view class="grid-text">兑换记录</view>
        <view class="badge" wx:if="{{metrics.redeemPending}}">{{metrics.redeemPending}}</view>
      </view>
    </view>
  </view>

  <view class="announcement-card">
    <view class="announcement-header">
      <view>
        <view class="announcement-title">活动公告</view>
        <view class="announcement-sub" wx:if="{{announcement && announcement.publishTime}}">最近发布：{{announcement.publishTime}}</view>
      </view>
      <view class="announcement-actions">
        <view class="announcement-action" bindtap="openAnnouncementSheet">
          <text class="announcement-icon">✎</text>
          <text class="announcement-action-text">发布公告</text>
        </view>
        <view wx:if="{{announcement}}" class="announcement-delete" bindtap="confirmDeleteAnnouncement">
          删除
        </view>
      </view>
    </view>
    <view class="announcement-body" wx:if="{{announcement}}">
      <view class="announcement-content">{{announcement.content}}</view>
      <view class="announcement-expire" wx:if="{{announcement.expireTime}}">
        截止：{{announcement.expireTime}}
      </view>
    </view>
    <view class="announcement-empty" wx:if="{{!announcement}}">
      暂未发布公告，点击右上角发布通知。
    </view>
  </view>

</view>

<view wx:if="{{announcementSheetVisible}}" class="sheet-mask" bindtap="closeAnnouncementSheet"></view>
<view wx:if="{{announcementSheetVisible}}" class="sheet-panel" catchtap="noop">
  <view class="sheet-header">
    <view class="sheet-title">发布活动公告</view>
  </view>
  <view class="sheet-form">
    <view class="dialog-field">
      <view class="dialog-label">标题</view>
      <input class="dialog-input"
             placeholder="例如：本周新增志愿活动"
             value="{{announcementForm.title}}"
             bindinput="onAnnouncementTitleInput" />
    </view>
    <view class="dialog-field">
      <view class="dialog-label">公告内容</view>
      <textarea class="dialog-textarea"
                placeholder="请输入公告内容"
                value="{{announcementForm.content}}"
                bindinput="onAnnouncementContentInput"></textarea>
    </view>
    <view class="dialog-field">
      <view class="dialog-label">截止时间 (可选)</view>
      <picker mode="date"
              value="{{announcementForm.expireTime}}"
              bindchange="onAnnouncementExpireInput">
        <view class="dialog-input dialog-picker">
          {{announcementForm.expireTime || '请选择截止日期'}}
        </view>
      </picker>
    </view>
    <view class="sheet-actions">
      <button class="dialog-cancel" bindtap="closeAnnouncementSheet">取消</button>
      <button class="dialog-confirm" bindtap="saveAnnouncement" loading="{{announcementSaving}}">保存并发布</button>
    </view>
  </view>
</view>