<!-- miniprogram/pages/admin/review.wxml -->
<view class="container">
  <view class="title">待审核申请</view>

  <view wx:if="{{loading}}" class="loading">加载中...</view>

  <block wx:if="{{applications.length > 0}}">
    <block wx:for="{{applications}}" wx:key="_id">
      <view class="card">
        <view class="card-left">
          <text class="project">{{item.projectName}}</text>
          <text class="name">申请人：{{item.name || item._openid}}</text>
          <text class="time">{{item.createTimeFormatted}}</text>
          <text class="reason">理由：{{item.reason || '—'}}</text>
        </view>

        <view class="card-right">
          <text class="status {{item.statusClass}}">{{item.status}}</text>

          <view class="btn-row">
            <button size="mini" bindtap="previewFile" data-fileid="{{item.fileID}}" wx:if="{{item.fileID}}">查看附件</button>

            <button size="mini" type="primary" bindtap="handleApprove" data-id="{{item._id}}" data-projectid="{{item.projectId}}">通过</button>

            <button size="mini" type="warn" bindtap="handleReject" data-id="{{item._id}}">驳回</button>
          </view>
        </view>
      </view>
    </block>
  </block>

  <view wx:else class="empty">当前没有待审核申请</view>
</view>
