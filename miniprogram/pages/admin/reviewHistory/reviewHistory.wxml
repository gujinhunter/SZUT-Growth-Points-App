<view class="page">
  <view class="header-card">
    <view class="title-area">
      <view class="title">审核历史</view>
      <view class="subtitle">最近 50 条记录，可通过筛选快速定位</view>
    </view>

    <view class="search-area">
      <view class="search-box">
        <icon type="search" size="16" color="#6480a0" />
        <input placeholder="搜索申请人 / 学号 / 项目 / 审核人"
               confirm-type="search"
               value="{{keyword}}"
               bindinput="onKeywordInput"
               bindconfirm="onSearchConfirm" />
        <view wx:if="{{keyword}}" class="clear-btn" bindtap="onKeywordClear">✕</view>
      </view>
      <button class="search-btn" bindtap="onSearch">搜索</button>
    </view>

    <view class="filter-area">
      <picker class="chip {{filterOptions.categories[filters.categoryIndex].value ? 'active' : ''}}"
              mode="selector"
              range="{{filterOptions.categories}}"
              range-key="label"
              value="{{filters.categoryIndex}}"
              bindchange="onCategoryChange">
        <view>{{filterOptions.categories[filters.categoryIndex].label}}</view>
      </picker>
      <picker class="chip {{filterOptions.statuses[filters.statusIndex].value ? 'active' : ''}}"
              mode="selector"
              range="{{filterOptions.statuses}}"
              range-key="label"
              value="{{filters.statusIndex}}"
              bindchange="onStatusChange">
        <view>{{filterOptions.statuses[filters.statusIndex].label}}</view>
      </picker>
    </view>
  </view>

  <view class="content">
    <view wx:if="{{loading}}" class="loading">加载中...</view>

    <scroll-view wx:elif="{{logs.length}}" scroll-y class="list">
      <block wx:for="{{logs}}" wx:key="_id">
        <view class="log-card">
          <view class="log-badge {{item.afterStatus === '已通过' ? 'approved' : (item.afterStatus === '已驳回' ? 'rejected' : 'pending')}}">
            {{item.afterStatusText}}
          </view>

          <view class="log-title">
            <text class="project">{{item.projectName}}</text>
            <text class="timestamp">{{item.createTimeFormatted}}</text>
          </view>

          <view class="log-meta">
            <view class="meta-item">
              <text class="meta-label">申请人</text>
              <text class="meta-value">{{item.studentName}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-label">类别</text>
              <text class="meta-value">{{item.projectCategory}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-label">审核人</text>
              <text class="meta-value">{{item.adminName}}</text>
            </view>
            <view class="meta-item" wx:if="{{item.remark}}">
              <text class="meta-label">备注</text>
              <text class="meta-value remark">{{item.remark}}</text>
            </view>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>
</view>