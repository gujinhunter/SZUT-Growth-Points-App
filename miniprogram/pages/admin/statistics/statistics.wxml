<view class="stats-page">
  <view class="summary-card">
    <view class="summary-header">
      <view>
        <view class="summary-title">å¹³å°è¿è¥æ¦‚è§ˆ</view>
        <view class="summary-desc">ç»Ÿè®¡åŒºé—´ï¼š{{summary.range || 'æœ€è¿‘30å¤©'}}</view>
      </view>
      <view class="refresh" bindtap="loadStatistics">åˆ·æ–°</view>
    </view>
    <view class="summary-grid">
      <view class="summary-item">
        <view class="item-label">æ€»ç”³è¯·é‡</view>
        <view class="item-value">{{summary.totalApplications}}</view>
        <view class="item-sub">ç¯æ¯” {{summary.applicationRise}}%</view>
      </view>
      <view class="summary-item">
        <view class="item-label">é€šè¿‡é‡</view>
        <view class="item-value">{{summary.approvedCount}}</view>
        <view class="item-sub">é€šè¿‡ç‡ {{summary.approvalRate}}%</view>
      </view>
      <view class="summary-item">
        <view class="item-label">é©³å›é‡</view>
        <view class="item-value">{{summary.rejectedCount}}</view>
        <view class="item-sub">é©³å›ç‡ {{summary.rejectRate}}%</view>
      </view>
    </view>
  </view>

  <view class="filter-card">
    <view class="card-title">å¿«é€Ÿç­›é€‰</view>
    <view class="filter-row">
      <picker mode="selector"
              range="{{filterOptions.dateRanges}}"
              value="{{filters.dateIndex}}"
              bindchange="onDateRangeChange">
        <view class="picker-display">
          {{filterOptions.dateRanges[filters.dateIndex] || 'æœ€è¿‘30å¤©'}}
        </view>
      </picker>

      <picker mode="selector"
              range="{{filterOptions.categories}}"
              range-key="label"
              value="{{filters.categoryIndex}}"
              bindchange="onCategoryChange">
        <view class="picker-display">
          {{filterOptions.categories[filters.categoryIndex].label}}
        </view>
      </picker>

      <button class="export-btn" bindtap="exportData">å¯¼å‡ºæŠ¥è¡¨</button>
    </view>
  </view>

  <view class="chart-card">
    <view class="card-header">
      <view class="card-title">ç”³è¯·é‡è¶‹åŠ¿</view>
      <view class="card-sub">å•ä½ï¼šæ¡ / å¤©</view>
    </view>
    <ec-canvas id="trendChart" canvas-id="trendChart" ec="{{trendChart}}"></ec-canvas>
  </view>

  <view class="chart-card">
    <view class="card-header">
      <view class="card-title">é¡¹ç›®ç”³è¯·åˆ†å¸ƒ</view>
      <view class="card-sub">å æ¯”æœ€å¤šçš„äº”ç±»é¡¹ç›®</view>
    </view>
    <ec-canvas id="pieChart" canvas-id="pieChart" ec="{{pieChart}}"></ec-canvas>
  </view>

  <view class="chart-card">
    <view class="card-header">
      <view class="card-title">ç±»åˆ«ç§¯åˆ†å æ¯”</view>
      <view class="card-sub">æŒ‰å·²é€šè¿‡ç”³è¯·ç»Ÿè®¡</view>
    </view>
    <ec-canvas id="categoryChart" canvas-id="categoryChart" ec="{{categoryChart}}"></ec-canvas>
  </view>

  <view class="ranking-card">
    <view class="card-header">
      <view class="card-title">æ€»ç§¯åˆ†æ’è¡Œæ¦œ</view>
      <view class="card-sub">å‰ {{rankingList.length}} å</view>
    </view>
    <block wx:if="{{rankingList.length > 0}}">
      <view class="ranking-row ranking-header">
        <text class="rank-col rank-num">æ’å</text>
        <text class="rank-col rank-name">å§“å</text>
        <text class="rank-col rank-student">å­¦å·</text>
        <text class="rank-col rank-points">æ€»ç§¯åˆ†</text>
      </view>
      <block wx:for="{{rankingList}}" wx:key="index">
        <view class="ranking-row {{index < 3 ? 'top-three' : ''}}">
          <text class="rank-col rank-num">
            <text wx:if="{{index === 0}}" class="rank-icon">ğŸ¥‡</text>
            <text wx:elif="{{index === 1}}" class="rank-icon">ğŸ¥ˆ</text>
            <text wx:elif="{{index === 2}}" class="rank-icon">ğŸ¥‰</text>
            <text wx:else>{{index + 1}}</text>
          </text>
          <text class="rank-col rank-name">{{item.name || 'æœªçŸ¥'}}</text>
          <text class="rank-col rank-student">{{item.studentId || 'â€”'}}</text>
          <text class="rank-col rank-points">{{item.totalPoints || 0}}</text>
        </view>
      </block>
    </block>
    <view wx:else class="empty">æš‚æ— æ•°æ®</view>
  </view>

  <view class="table-card">
    <view class="card-header">
      <view class="card-title">è¿‘æœŸç®¡ç†å‘˜æ“ä½œ</view>
      <view class="card-sub">æ¥è‡ª reviewLogs</view>
    </view>
    <block wx:if="{{logs.length}}">
      <view class="log-row log-header">
        <text class="col col-admin">ç®¡ç†å‘˜</text>
        <text class="col col-action">æ“ä½œ</text>
        <text class="col col-project">é¡¹ç›®</text>
        <text class="col col-time">æ—¶é—´</text>
      </view>
      <block wx:for="{{logs}}" wx:key="id">
        <view class="log-row">
          <text class="col col-admin">{{item.adminName || 'æœªçŸ¥'}}</text>
          <text class="col col-action">{{item.actionText}}</text>
          <text class="col col-project">{{item.projectName || 'â€”'}}</text>
          <text class="col col-time">{{item.time}}</text>
        </view>
      </block>
    </block>
    <view wx:else class="empty">æš‚æ— è®°å½•</view>
  </view>
</view>