<!-- miniprogram/pages/admin/statistics/statistics.wxml -->
<view class="page">
  <view class="page-header">
  <view class="header-top">
    <view class="title">积分统计</view>
    <view class="timestamp">
      <text>上次更新：</text>
      <text>{{lastRefresh || '—'}}</text>
    </view>
  </view>

  <button class="export-btn"
          bindtap="handleExport"
          loading="{{exporting}}"
          disabled="{{exporting || loading}}">
    导出名单
  </button>
</view>

  <view class="table-wrapper" wx:if="{{students.length}}">
    <view class="table-header">
      <view class="cell rank">排名</view>
      <view class="cell name">姓名</view>
      <view class="cell id">学号</view>
      <view class="cell academy">学院/班级</view>
      <view class="cell points">总积分</view>
    </view>
    <scroll-view scroll-y class="table-body">
      <block wx:for="{{students}}" wx:key="studentId">
        <view class="table-row {{index % 2 === 0 ? '' : 'odd'}}">
          <view class="cell rank">{{item.rank}}</view>
          <view class="cell name">{{item.name}}</view>
          <view class="cell id">{{item.studentId}}</view>
          <view class="cell academy">
            <text>{{item.academy || ''}}</text>
            <text wx:if="{{item.className}}"> / {{item.className}}</text>
          </view>
          <view class="cell points">{{item.totalPoints}}</view>
        </view>
      </block>
    </scroll-view>
  </view>

  <view class="empty" wx:else>
    <image src="/assets/empty.png" mode="widthFix" wx:if="{{loading === false}}"></image>
    <text>{{emptyText}}</text>
  </view>
</view>