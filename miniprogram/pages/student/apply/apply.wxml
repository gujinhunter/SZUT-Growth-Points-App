<view class="apply-page">

  <view class="hero-card">
    <text class="hero-badge">申请项目</text>
    <view class="hero-title">{{projectName || '待选项目'}}</view>
    <view class="hero-desc">请完善以下信息，提交后我们会在 15 个工作日内反馈结果</view>
  </view>

  <view class="edit-alert" wx:if="{{isEditMode}}">
    <view>该申请已被驳回，请根据说明修改后重新提交。</view>
    <view class="edit-remark" wx:if="{{rejectRemark}}">驳回说明：{{rejectRemark}}</view>
  </view>

  <form class="form-card" bindsubmit="submitForm">
  <view class="section">
    <view class="section-title">基本信息</view>

    <view class="field" wx:if="{{scoreOptions.length > 0}}">
      <view class="field-label">申请积分</view>
      <picker mode="selector" 
              range="{{scoreOptions}}" 
              value="{{selectedScoreIndex}}" 
              bindchange="onScoreChange">
        <view class="picker-display">
          {{scoreOptions[selectedScoreIndex] || '请选择积分'}} 分
        </view>
      </picker>
    </view>
  </view>

  <view class="section">
    <view class="section-title">申请理由</view>

    <view class="field">
      <textarea name="reason"
                value="{{reasonText}}"
                bindinput="onReasonInput"
                placeholder="请详细描述申请原因、预期收获等信息"
                placeholder-class="placeholder"
                auto-height></textarea>
      <view class="word-limit">建议不超过 50 字</view>
    </view>
  </view>

  <view class="section">
    <view class="section-title">附件上传</view>

    <view class="upload-panel">
      <view class="upload-left">
        <view class="upload-desc">支持 1～3 张图片，请将证明材料转成图片上传</view>
        <view class="upload-files" wx:if="{{fileNames.length}}">
          <block wx:for="{{fileNames}}" wx:key="index">
            <view class="upload-file">{{item}}</view>
          </block>
        </view>
      </view>
      <button type="default" class="upload-btn" bindtap="chooseFile">选择文件</button>
    </view>
    <button wx:if="{{isEditMode && fileIDs.length}}" type="default" class="reset-files-btn" bindtap="resetFiles">
      重新上传附件
    </button>
  </view>

  <button formType="submit"
          type="primary"
          class="submit-btn"
          loading="{{submitting}}"
          disabled="{{submitting}}">
    提交申请
  </button>
</form>
</view>